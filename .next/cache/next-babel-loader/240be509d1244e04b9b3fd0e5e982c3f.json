{"ast":null,"code":"import { MongoClient } from 'mongodb';\nconst client = new MongoClient(process.env.MONGODB_URI, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\nexport async function setUpDb(db) {\n  db.collection('users').createIndex({\n    email: 1\n  }, {\n    unique: true\n  });\n}\nexport default async function database(req, res, next) {\n  if (!client.isConnected()) await client.connect();\n  req.dbClient = client;\n  req.db = client.db(process.env.MONGODB_DB);\n  await setUpDb(req.db);\n  return next();\n}","map":{"version":3,"sources":["/Users/kevin/Desktop/Next.js-Mongodb-Authentication-App/middlewares/database.js"],"names":["MongoClient","client","process","env","MONGODB_URI","useNewUrlParser","useUnifiedTopology","setUpDb","db","collection","createIndex","email","unique","database","req","res","next","isConnected","connect","dbClient","MONGODB_DB"],"mappings":"AAAA,SAASA,WAAT,QAA4B,SAA5B;AAEA,MAAMC,MAAM,GAAG,IAAID,WAAJ,CAAgBE,OAAO,CAACC,GAAR,CAAYC,WAA5B,EAAyC;AACtDC,EAAAA,eAAe,EAAE,IADqC;AAEtDC,EAAAA,kBAAkB,EAAE;AAFkC,CAAzC,CAAf;AAIA,OAAO,eAAeC,OAAf,CAAuBC,EAAvB,EAA2B;AAChCA,EAAAA,EAAE,CAACC,UAAH,CAAc,OAAd,EAAuBC,WAAvB,CAAmC;AAAEC,IAAAA,KAAK,EAAE;AAAT,GAAnC,EAAiD;AAAEC,IAAAA,MAAM,EAAE;AAAV,GAAjD;AACD;AAED,eAAe,eAAeC,QAAf,CAAwBC,GAAxB,EAA6BC,GAA7B,EAAkCC,IAAlC,EAAwC;AACrD,MAAI,CAACf,MAAM,CAACgB,WAAP,EAAL,EAA2B,MAAMhB,MAAM,CAACiB,OAAP,EAAN;AAC3BJ,EAAAA,GAAG,CAACK,QAAJ,GAAelB,MAAf;AACAa,EAAAA,GAAG,CAACN,EAAJ,GAASP,MAAM,CAACO,EAAP,CAAUN,OAAO,CAACC,GAAR,CAAYiB,UAAtB,CAAT;AACA,QAAMb,OAAO,CAACO,GAAG,CAACN,EAAL,CAAb;AACA,SAAOQ,IAAI,EAAX;AACD","sourcesContent":["import { MongoClient } from 'mongodb';\n\nconst client = new MongoClient(process.env.MONGODB_URI, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n});\nexport async function setUpDb(db) {\n  db.collection('users').createIndex({ email: 1 }, { unique: true });\n}\n\nexport default async function database(req, res, next) {\n  if (!client.isConnected()) await client.connect();\n  req.dbClient = client;\n  req.db = client.db(process.env.MONGODB_DB);\n  await setUpDb(req.db);\n  return next();\n}\n"]},"metadata":{},"sourceType":"module"}