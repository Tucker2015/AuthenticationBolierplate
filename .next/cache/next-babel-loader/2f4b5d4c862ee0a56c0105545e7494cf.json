{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/kevin/Desktop/Next.js-Mongodb-Authentication-App/components/setting.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport Head from 'next/head';\nimport { useCurrentUser } from '../lib/hooks';\n\nvar ProfileSection = function ProfileSection() {\n  _s();\n\n  var _useCurrentUser = useCurrentUser(),\n      _useCurrentUser2 = _slicedToArray(_useCurrentUser, 2),\n      user = _useCurrentUser2[0],\n      mutate = _useCurrentUser2[1].mutate;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      isLoading = _useState[1];\n\n  var nameRef = useRef();\n  var bioRef = useRef();\n  var profilePictureRef = useRef();\n\n  var _useState2 = useState({\n    message: '',\n    isError: false\n  }),\n      msg = _useState2[0],\n      setMsg = _useState2[1];\n\n  useEffect(function () {\n    nameRef.current.value = user.name;\n    bioRef.current.value = user.bio;\n  }, [user]);\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var formData, res, userData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              isLoading(true);\n              formData = new FormData();\n\n              if (profilePictureRef.current.files[0]) {\n                formData.append('profilePicture', profilePictureRef.current.files[0]);\n              }\n\n              formData.append('name', nameRef.current.value);\n              formData.append('bio', bioRef.current.value);\n              _context.next = 8;\n              return fetch('/api/user', {\n                method: 'PATCH',\n                body: formData\n              });\n\n            case 8:\n              res = _context.sent;\n\n              if (!(res.status === 200)) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 12;\n              return res.json();\n\n            case 12:\n              userData = _context.sent;\n              mutate({\n                user: _objectSpread(_objectSpread({}, user), userData.user)\n              });\n              setMsg({\n                message: 'Profile updated'\n              });\n              _context.next = 23;\n              break;\n\n            case 17:\n              _context.t0 = setMsg;\n              _context.next = 20;\n              return res.text();\n\n            case 20:\n              _context.t1 = _context.sent;\n              _context.t2 = {\n                message: _context.t1,\n                isError: true\n              };\n              (0, _context.t0)(_context.t2);\n\n            case 23:\n              isLoading(false);\n\n            case 24:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleSubmitPasswordChange = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var body, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              isLoading(true);\n              e.preventDefault();\n              body = {\n                oldPassword: e.currentTarget.oldPassword.value,\n                newPassword: e.currentTarget.newPassword.value\n              };\n              e.currentTarget.oldPassword.value = '';\n              e.currentTarget.newPassword.value = '';\n              _context2.next = 7;\n              return fetch('/api/user/password', {\n                method: 'PUT',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(body)\n              });\n\n            case 7:\n              res = _context2.sent;\n\n              if (!(res.status === 200)) {\n                _context2.next = 12;\n                break;\n              }\n\n              setMsg({\n                message: 'Password updated'\n              });\n              _context2.next = 18;\n              break;\n\n            case 12:\n              _context2.t0 = setMsg;\n              _context2.next = 15;\n              return res.text();\n\n            case 15:\n              _context2.t1 = _context2.sent;\n              _context2.t2 = {\n                message: _context2.t1,\n                isError: true\n              };\n              (0, _context2.t0)(_context2.t2);\n\n            case 18:\n              isLoading(false);\n\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleSubmitPasswordChange(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(Head, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }\n  }, __jsx(\"title\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 17\n    }\n  }, \"Settings\")), loading ? __jsx(\"div\", {\n    className: \"progress\",\n    style: {\n      margin: 0\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 24\n    }\n  }, __jsx(\"div\", {\n    className: \"indeterminate\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 17\n    }\n  })) : null, __jsx(\"section\", {\n    className: \"\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 13\n    }\n  }, __jsx(\"h2\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 17\n    }\n  }, \"Edit Profile\"), msg.message ? __jsx(\"p\", {\n    style: {\n      color: msg.isError ? 'red' : '#0070f3',\n      textAlign: 'center'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 32\n    }\n  }, msg.message) : null, __jsx(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"col s12\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: \"divider\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 21\n    }\n  }), __jsx(\"label\", {\n    htmlFor: \"name\",\n    className: \"input-field col s6\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 21\n    }\n  }, \"Name\", __jsx(\"input\", {\n    required: true,\n    id: \"name\",\n    name: \"name\",\n    type: \"text\",\n    placeholder: \"Your name\",\n    ref: nameRef,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 29\n    }\n  })), __jsx(\"label\", {\n    htmlFor: \"bio\",\n    className: \"input-field col s6\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 21\n    }\n  }, \"Bio\", __jsx(\"textarea\", {\n    id: \"bio\",\n    name: \"bio\",\n    type: \"text\",\n    placeholder: \"Bio\",\n    ref: bioRef,\n    className: \"materialize-textarea\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 25\n    }\n  })), __jsx(\"label\", {\n    htmlFor: \"avatar\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 21\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 25\n    }\n  }, \"Profile picture \\xA0 \"), __jsx(\"div\", {\n    className: \"btn-small file-field input-field blue\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 25\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 29\n    }\n  }, \"Choose file\"), __jsx(\"input\", {\n    type: \"file\",\n    id: \"avatar\",\n    name: \"avatar\",\n    accept: \"image/png, image/jpeg\",\n    ref: profilePictureRef,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 29\n    }\n  }))), __jsx(\"br\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 21\n    }\n  }), __jsx(\"button\", {\n    type: \"submit\",\n    className: \"btn blue\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 21\n    }\n  }, \"Save\")), __jsx(\"form\", {\n    onSubmit: handleSubmitPasswordChange,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 17\n    }\n  }, __jsx(\"label\", {\n    htmlFor: \"oldpassword\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 21\n    }\n  }, \"Old Password\", __jsx(\"input\", {\n    type: \"password\",\n    name: \"oldPassword\",\n    id: \"oldpassword\",\n    required: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 13\n    }\n  })), __jsx(\"label\", {\n    htmlFor: \"newpassword\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 21\n    }\n  }, \"New Password\", __jsx(\"input\", {\n    type: \"password\",\n    name: \"newPassword\",\n    id: \"newpassword\",\n    required: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 13\n    }\n  })), __jsx(\"button\", {\n    type: \"submit\",\n    className: \"btn blue\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 21\n    }\n  }, \"Change Password\"))));\n};\n\n_s(ProfileSection, \"8SLA8ZkkurXfTyf1eAPN1YZCo5c=\", false, function () {\n  return [useCurrentUser];\n});\n\n_c = ProfileSection;\n\nvar SettingPage = function SettingPage() {\n  _s2();\n\n  var _useCurrentUser3 = useCurrentUser(),\n      _useCurrentUser4 = _slicedToArray(_useCurrentUser3, 1),\n      user = _useCurrentUser4[0];\n\n  if (!user) {\n    return __jsx(React.Fragment, null, __jsx(\"p\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 17\n      }\n    }, \"Please sign in\"));\n  }\n\n  return __jsx(React.Fragment, null, __jsx(ProfileSection, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }\n  }));\n};\n\n_s2(SettingPage, \"QUKPgfFzS7L6bdsBDYfT2rq3xLo=\", false, function () {\n  return [useCurrentUser];\n});\n\n_c2 = SettingPage;\nexport default SettingPage;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ProfileSection\");\n$RefreshReg$(_c2, \"SettingPage\");","map":{"version":3,"sources":["/Users/kevin/Desktop/Next.js-Mongodb-Authentication-App/components/setting.jsx"],"names":["React","useState","useEffect","useRef","Head","useCurrentUser","ProfileSection","user","mutate","loading","isLoading","nameRef","bioRef","profilePictureRef","message","isError","msg","setMsg","current","value","name","bio","handleSubmit","event","preventDefault","formData","FormData","files","append","fetch","method","body","res","status","json","userData","text","handleSubmitPasswordChange","e","oldPassword","currentTarget","newPassword","headers","JSON","stringify","margin","color","textAlign","SettingPage"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport Head from 'next/head';\nimport { useCurrentUser } from '../lib/hooks';\n\nconst ProfileSection = () => {\n    const [user, { mutate }] = useCurrentUser();\n    const [loading, isLoading] = useState(false);\n    const nameRef = useRef();\n    const bioRef = useRef();\n    const profilePictureRef = useRef();\n    const [msg, setMsg] = useState({ message: '', isError: false });\n\n    useEffect(() => {\n        nameRef.current.value = user.name;\n        bioRef.current.value = user.bio;\n    }, [user]);\n\n    const handleSubmit = async (event) => {\n        event.preventDefault();\n        isLoading(true);\n        const formData = new FormData();\n        if (profilePictureRef.current.files[0]) { formData.append('profilePicture', profilePictureRef.current.files[0]); }\n        formData.append('name', nameRef.current.value);\n        formData.append('bio', bioRef.current.value);\n\n        const res = await fetch('/api/user', {\n            method: 'PATCH',\n            body: formData,\n        });\n        if (res.status === 200) {\n            const userData = await res.json();\n            mutate({\n                user: {\n                    ...user,\n                    ...userData.user,\n                },\n            });\n            setMsg({ message: 'Profile updated' });\n        } else {\n            setMsg({ message: await res.text(), isError: true });\n        }\n        isLoading(false);\n    };\n\n    const handleSubmitPasswordChange = async (e) => {\n        isLoading(true);\n        e.preventDefault();\n        const body = {\n            oldPassword: e.currentTarget.oldPassword.value,\n            newPassword: e.currentTarget.newPassword.value,\n        };\n        e.currentTarget.oldPassword.value = '';\n        e.currentTarget.newPassword.value = '';\n\n        const res = await fetch('/api/user/password', {\n            method: 'PUT',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(body),\n        });\n\n        if (res.status === 200) {\n            setMsg({ message: 'Password updated' });\n        } else {\n            setMsg({ message: await res.text(), isError: true });\n        }\n        isLoading(false);\n    };\n\n    return (\n        <>\n            <Head>\n                <title>Settings</title>\n            </Head>\n            {loading ? <div className=\"progress\" style={{ margin: 0 }}>\n                <div className=\"indeterminate\"></div>\n            </div> : null}\n            <section className=\"\">\n                <h2>Edit Profile</h2>\n                {msg.message ? <p style={{ color: msg.isError ? 'red' : '#0070f3', textAlign: 'center' }}>{msg.message}</p> : null}\n                <form onSubmit={handleSubmit} className=\"col s12\">\n                    <div className=\"divider\"></div>\n                    <label htmlFor=\"name\" className=\"input-field col s6\">\n                        Name\n                            <input\n                            required\n                            id=\"name\"\n                            name=\"name\"\n                            type=\"text\"\n                            placeholder=\"Your name\"\n                            ref={nameRef}\n                        />\n                    </label>\n                    <label htmlFor=\"bio\" className=\"input-field col s6\">\n                        Bio\n                        <textarea\n                            id=\"bio\"\n                            name=\"bio\"\n                            type=\"text\"\n                            placeholder=\"Bio\"\n                            ref={bioRef}\n                            className=\"materialize-textarea\"\n                        />\n                    </label>\n                    <label htmlFor=\"avatar\">\n                        <span>Profile picture &nbsp; </span>\n                        <div className=\"btn-small file-field input-field blue\">\n                            <span>Choose file</span>\n                            <input\n                                type=\"file\"\n                                id=\"avatar\"\n                                name=\"avatar\"\n                                accept=\"image/png, image/jpeg\"\n                                ref={profilePictureRef}\n                            />\n                        </div>\n                    </label>\n                    <br />\n                    <button type=\"submit\" className=\"btn blue\">Save</button>\n                </form>\n                <form onSubmit={handleSubmitPasswordChange}>\n                    <label htmlFor=\"oldpassword\">\n                        Old Password\n            <input\n                            type=\"password\"\n                            name=\"oldPassword\"\n                            id=\"oldpassword\"\n                            required\n                        />\n                    </label>\n                    <label htmlFor=\"newpassword\">\n                        New Password\n            <input\n                            type=\"password\"\n                            name=\"newPassword\"\n                            id=\"newpassword\"\n                            required\n                        />\n                    </label>\n                    <button type=\"submit\" className=\"btn blue\">Change Password</button>\n                </form>\n            </section>\n        </>\n    );\n};\nconst SettingPage = () => {\n    const [user] = useCurrentUser();\n    if (!user) {\n        return (\n            <>\n                <p>Please sign in</p>\n            </>\n        );\n    }\n    return (\n        <>\n            <ProfileSection />\n        </>\n    );\n};\nexport default SettingPage;"]},"metadata":{},"sourceType":"module"}